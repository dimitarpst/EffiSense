@model Usage

@{
    ViewData["Title"] = "Log New Usage";
    // Recreate helper here if needed, or move to a shared location/service
    Func<int, string> GetFrequencyText = (freq) =>
    {
        return freq switch
        {
            1 => "Rarely",
            2 => "Sometimes",
            3 => "Often",
            4 => "Very Often",
            5 => "Always",
            _ => "N/A"
        };
    };
    var frequencyOptions = Enumerable.Range(1, 5).Select(i => new SelectListItem { Value = i.ToString(), Text = GetFrequencyText(i) });
}

<div class="form-container">
    <h1 class="text-center">@ViewData["Title"]</h1>
    <hr />
    <form asp-action="Create">
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

        @* Appliance Selection - Assuming ViewBag.ApplianceId is populated in controller *@
        <div class="input-group mb-3">
            <span class="input-group-text"><i class="fas fa-plug"></i></span>
            <div class="form-floating flex-grow-1">
                <select asp-for="ApplianceId" class="form-select" asp-items="ViewBag.ApplianceId">
                    <option value="">-- Select Appliance --</option>
                </select>
                <label asp-for="ApplianceId"></label>
            </div>
        </div>
        <span asp-validation-for="ApplianceId" class="text-danger d-block mb-2"></span>

        @* Date and Time Inputs side-by-side *@
        <div class="row g-3">
            <div class="col-md-6">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                    <div class="form-floating flex-grow-1">
                        <input asp-for="Date" type="date" class="form-control" />
                        <label asp-for="Date"></label>
                    </div>
                </div>
                <span asp-validation-for="Date" class="text-danger d-block mb-2"></span>
            </div>
            <div class="col-md-6">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="fas fa-clock"></i></span>
                    <div class="form-floating flex-grow-1">
                        <input asp-for="Time" type="time" class="form-control" />
                        <label asp-for="Time"></label>
                    </div>
                </div>
                <span asp-validation-for="Time" class="text-danger d-block mb-2"></span>
            </div>
        </div>

        @* Energy Used and Frequency side-by-side *@
        <div class="row g-3">
            <div class="col-md-6">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="fas fa-bolt"></i></span>
                    <div class="form-floating flex-grow-1">
                        <input asp-for="EnergyUsed" type="number" step="0.01" class="form-control" placeholder="Energy Used (kWh)" />
                        <label asp-for="EnergyUsed"></label>
                    </div>
                </div>
                <span asp-validation-for="EnergyUsed" class="text-danger d-block mb-2"></span>
            </div>
            <div class="col-md-6">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="fas fa-sync-alt"></i></span>
                    <div class="form-floating flex-grow-1">
                        <select asp-for="UsageFrequency" class="form-select" asp-items="frequencyOptions">
                            <option value="">-- Select Frequency --</option>
                        </select>
                        <label asp-for="UsageFrequency"></label>
                    </div>
                </div>
                <span asp-validation-for="UsageFrequency" class="text-danger d-block mb-2"></span>
            </div>
        </div>

        @* --- NEW FIELDS --- *@
        <div class="input-group mb-3">
            <span class="input-group-text"><i class="fas fa-info-circle"></i></span>
            <div class="form-floating flex-grow-1">
                <textarea asp-for="ContextNotes" class="form-control" placeholder="Context or Notes (e.g., Guests over, Weekend cleaning)" style="height: 80px"></textarea>
                <label asp-for="ContextNotes"></label>
            </div>
        </div>
        <span asp-validation-for="ContextNotes" class="text-danger d-block mb-2"></span>

        @* IconClass is likely derived, so keep it hidden *@
        <input type="hidden" asp-for="IconClass" />
        @* --- END NEW FIELDS --- *@


        <div class="d-grid gap-2 mt-4">
            <button type="submit" class="btn btn-primary btn-lg">Log Usage</button>
            <a asp-action="Index" class="btn btn-secondary">Back to List</a>
        </div>
    </form>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    @* Include JS for dependent dropdown if Appliance depends on Home selection *@
    @* <script src="~/js/usageCreate.js" asp-append-version="true"></script> *@
}
